---
import Footer from '@/components/Layout/Footer.astro'
import Header from '@/components/Layout/Header.astro'
import Head from '@/components/Meta/Head.astro'
import SkipLink from '@/components/ui/SkipLink.astro'
import { defaultSeo } from '@/config/seo'
import { cn } from '@/lib/utils/cn'
import { resolveOgImageUrl } from '@/lib/utils/og'

import '@/styles/global.css'

type Props = {
  pageTitle?: string
  pageDescription?: string
}

const { pageTitle = defaultSeo.baseTitle, pageDescription = defaultSeo.metaDescription } =
  Astro.props

const pathname = Astro.url.pathname
const params = Astro.params

const ogImageUrl = resolveOgImageUrl({ params, pathname })

const hasCustomMain = Astro.slots.has('main')
---

<html lang="en">
  <head>
    <Head title={pageTitle} description={pageDescription} ogImagePath={ogImageUrl}>
      <slot name="head" />
    </Head>
  </head>

  <body>
    <SkipLink />
    <Header />

    {
      hasCustomMain ? (
        // Page owns the whole main area (e.g., ReadingLayout with main+aside)
        <slot name="main" />
      ) : (
        // Fallback: wrap default content in a semantic <main>
        <main
          id="main-content"
          tabindex="-1"
          class={cn(
            'mx-auto max-w-6xl scroll-mt-[calc(var(--header-h)+1.25rem)] px-5 pb-40',
            'focus:outline-none',
            'md:px-8',
          )}
        >
          <slot name="beforeContent" />
          <slot />
          <slot name="afterContent" />
        </main>
      )
    }

    <Footer />

    <slot name="endOfBody" />
  </body>
</html>
