---
import type { GetStaticPaths } from 'astro'
import { getCollection, render } from 'astro:content'
import BlogPostLayout from '@/layouts/BlogPostLayout.astro'
import Prose from '@/components/Prose.astro'
import Link from '@/components/Link.astro'

export const getStaticPaths = (async () => {
  const posts = await getCollection('blog')
  return posts.map((post) => ({
    params: { slug: post.id },
    props: { post },
  }))
}) satisfies GetStaticPaths

const { post } = Astro.props
const { Content } = await render(post)

const { title, draft, date, excerpt } = post.data

if (import.meta.env.PROD && draft) {
  return new Response(null, {
    status: 404,
  })
}
---

<BlogPostLayout
  title={title}
  draft={draft}
  excerpt={excerpt}
  date={date}
>
  <Prose>
    <Content components={{ a: Link }} />
  </Prose>
</BlogPostLayout>
