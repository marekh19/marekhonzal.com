---
import type { GetStaticPaths } from 'astro'
import { getCollection, render } from 'astro:content'
import BlogPostLayout from '@/layouts/BlogPostLayout.astro'
import Prose from '@/components/Prose.astro'
import Link from '@/components/Link.astro'
import Alert from '@/components/Alert/Alert.astro'
import H1 from '@/components/Heading/H1.astro'
import H2 from '@/components/Heading/H2.astro'
import H3 from '@/components/Heading/H3.astro'
import H4 from '@/components/Heading/H4.astro'
import H5 from '@/components/Heading/H5.astro'
import H6 from '@/components/Heading/H6.astro'
import { shouldIncludePost } from '@/lib/utils/posts'

export const getStaticPaths = (async () => {
  const posts = await getCollection('blog', shouldIncludePost)

  return posts.map((post) => ({
    params: { slug: post.id },
    props: { post },
  }))
}) satisfies GetStaticPaths

const { post } = Astro.props
const { Content } = await render(post)

const { data } = post
---

<BlogPostLayout {...data}>
  <Prose>
    <Content
      components={{
        a: Link,
        Alert,
        h1: H1,
        h2: H2,
        h3: H3,
        h4: H4,
        h5: H5,
        h6: H6,
      }}
    />
  </Prose>
</BlogPostLayout>
