---
import type { GetStaticPaths } from 'astro'
import { getCollection, render } from 'astro:content'

import ProjectHeader from '@/components/Content/ProjectHeader.astro'
import { mdxComponents } from '@/components/MDX/MDXComponents.astro'
import ReadingLayout from '@/layouts/ReadingLayout.astro'
import { shouldIncludeItem } from '@/lib/utils/content'

export const getStaticPaths = (async () => {
  const projects = await getCollection('projects', shouldIncludeItem)

  return projects.map((project) => ({
    params: { slug: project.id },
    props: { project },
  }))
}) satisfies GetStaticPaths

const { project } = Astro.props
const { Content, headings } = await render(project)

const { data } = project
---

<ReadingLayout
  pageTitle={data.title}
  pageDescription={data.description}
  headings={headings}
>
  <Fragment slot="contentHeader">
    <ProjectHeader {...data} className="mt-5" />
  </Fragment>

  <Content components={mdxComponents} />
</ReadingLayout>
