---
import type { ImageMetadata } from 'astro'
import { Image } from 'astro:assets'
import { Icon } from 'astro-icon/components'

import { cn } from '@/lib/utils/cn'
import { formatDateMachine } from '@/lib/utils/date'

const IMAGE_CONFIG = {
  widths: [340, 480, 656, 720, 768, 960, 1024, 1280],
  sizes: `
    (max-width: 599px) calc(100vw - 2.5rem),
    (max-width: 1023px) calc(50vw - 6rem),
    340px
  `,
}

type Props = {
  title: string
  description: string
  targetUrl: string
  date: Date
  thumbnail: ImageMetadata
  isPriorityImage?: boolean
}

const {
  title,
  description,
  targetUrl,
  date,
  thumbnail,
  isPriorityImage = false,
} = Astro.props
---

<a
  href={targetUrl}
  class={cn(
    'border-base-content/15 group bg-base-100 overflow-hidden rounded-xl border transition-colors duration-200 ease-out',
    'hover:border-base-content/25',
    'link-outline',
  )}
>
  <article class={cn('flex h-full flex-col', 'lg:flex-row')}>
    <div class="aspect-og relative shrink-0 self-stretch overflow-hidden">
      <Image
        src={thumbnail}
        alt={title}
        priority={isPriorityImage}
        class={cn(
          'size-full object-cover transition-transform duration-300 ease-out',
          'motion-safe:group-hover:scale-105 motion-safe:group-focus-visible:scale-105',
          'lg:max-w-[22.5rem]',
        )}
        {...IMAGE_CONFIG}
      />
      <time
        datetime={formatDateMachine(date)}
        class="badge badge-sm absolute top-1 left-1 font-semibold"
        >{date.getFullYear()}</time
      >
    </div>
    <div class="p-4">
      <h3 class="mb-3 line-clamp-2 text-lg font-bold">{title}</h3>
      <p class="text-base-content/75 mb-3 line-clamp-3">{description}</p>
      <span class="mt-auto inline-flex items-center gap-1"
        >Read more<Icon
          name="lucide:arrow-right"
          class="ease-springy size-4 transition-transform duration-300 motion-safe:group-hover:translate-x-1.25 motion-safe:group-focus-visible:translate-x-1.25"
        /></span
      >
    </div>
  </article>
</a>
