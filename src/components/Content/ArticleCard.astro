---
import type { ImageMetadata } from 'astro'
import { Image } from 'astro:assets'
import { Icon } from 'astro-icon/components'

import { cn } from '@/lib/utils/cn'
import { formatDateHuman, formatDateMachine } from '@/lib/utils/date'

const IMAGE_CONFIG = {
  widths: [480, 720, 768, 960, 1024, 1280],
  sizes: '(max-width: 599px) 545px, (max-width: 1023px) 455px, 360px',
}

type Props = {
  title: string
  description: string
  targetUrl: string
  date: Date
  thumbnail: ImageMetadata
  tags?: string[]
  isPriorityImage?: boolean
}

const {
  title,
  description,
  targetUrl,
  date,
  thumbnail,
  tags,
  isPriorityImage = false,
} = Astro.props

const hasTags = !!tags && tags.length > 0
---

<a
  href={targetUrl}
  class={cn(
    'border-base-content/15 group bg-base-100 overflow-hidden rounded-xl border transition-colors duration-200 ease-out',
    'hover:border-base-content/25',
    'link-outline',
  )}
>
  <article class="flex h-full flex-col">
    <div class="aspect-og relative overflow-hidden">
      <Image
        src={thumbnail}
        alt={title}
        priority={isPriorityImage}
        class={cn(
          'size-full object-cover transition-transform duration-300 ease-out',
          'motion-safe:group-hover:scale-105 motion-safe:group-focus-visible:scale-105',
          'lg:max-w-[22.5rem]',
        )}
        {...IMAGE_CONFIG}
      />
    </div>
    <div class="flex grow flex-col p-4">
      <div class="mb-3 flex items-start justify-between gap-3">
        <time
          class="text-base-content/75 text-xs text-nowrap"
          datetime={formatDateMachine(date)}>{formatDateHuman(date)}</time
        >
        {
          hasTags && (
            <div class="flex flex-wrap gap-1.5">
              {tags.map((tag) => (
                <span class="badge badge-accent badge-soft badge-xs">{tag}</span>
              ))}
            </div>
          )
        }
      </div>
      <h3 class="mb-3 line-clamp-2 text-lg font-bold">{title}</h3>
      <p class="text-base-content/75 mb-3 line-clamp-3">{description}</p>
      <span class="mt-auto inline-flex items-center gap-1"
        >Read more<Icon
          name="lucide:arrow-right"
          class="ease-springy size-4 transition-transform duration-300 motion-safe:group-hover:translate-x-1.25 motion-safe:group-focus-visible:translate-x-1.25"
        /></span
      >
    </div>
  </article>
</a>
