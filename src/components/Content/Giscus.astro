---
type Props = {
  className?: string
}

const { className } = Astro.props
---

<div id="giscus-container" class={className}></div>
<script>
  const GISCUS_CONFIG = {
    src: 'https://giscus.app/client.js',
    repo: 'marekh19/marekhonzal.com',
    'repo-id': 'R_kgDOPXQyoQ',
    category: 'Announcements',
    'category-id': 'DIC_kwDOPXQyoc4CuFCB',
    mapping: 'pathname',
    strict: '0',
    'reactions-enabled': '1',
    'emit-metadata': '0',
    'input-position': 'top',
    theme: 'preferred_color_scheme',
    lang: 'en',
    loading: 'lazy',
  }

  document.addEventListener('astro:page-load', () => {
    const container = document.getElementById('giscus-container')
    if (!container) return
    container.innerHTML = ''

    const script = document.createElement('script')
    script.src = GISCUS_CONFIG.src
    script.crossOrigin = 'anonymous'
    script.async = true
    for (const [key, value] of Object.entries(GISCUS_CONFIG)) {
      if (key !== 'src') {
        script.setAttribute(`data-${key}`, value)
      }
    }
    container.appendChild(script)
  })
</script>
